# ğŸ”§ ìš´ì˜ ê°€ì´ë“œ

**HankookTire SmartSensor 2.0 ì‹œìŠ¤í…œ ìš´ì˜ ë° ê´€ë¦¬**

ì´ ê°€ì´ë“œëŠ” HankookTire SmartSensor 2.0 ì‹œìŠ¤í…œì˜ ì¼ìƒì ì¸ ìš´ì˜, ê´€ë¦¬, ìœ ì§€ë³´ìˆ˜ ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [ìš´ì˜ ê°œìš”](#-ìš´ì˜-ê°œìš”)
2. [ì¼ìƒ ìš´ì˜ ì‘ì—…](#-ì¼ìƒ-ìš´ì˜-ì‘ì—…)
3. [ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§](#-ì‹œìŠ¤í…œ-ëª¨ë‹ˆí„°ë§)
4. [ì„±ëŠ¥ ê´€ë¦¬](#-ì„±ëŠ¥-ê´€ë¦¬)
5. [ë°±ì—… ë° ë³µêµ¬](#-ë°±ì—…-ë°-ë³µêµ¬)
6. [ë³´ì•ˆ ê´€ë¦¬](#-ë³´ì•ˆ-ê´€ë¦¬)
7. [ì¥ì•  ëŒ€ì‘](#-ì¥ì• -ëŒ€ì‘)
8. [ìš©ëŸ‰ ê³„íš](#-ìš©ëŸ‰-ê³„íš)

## ğŸ¯ ìš´ì˜ ê°œìš”

### ìš´ì˜ íŒ€ êµ¬ì¡°

#### ì—­í•  ë° ì±…ì„
```yaml
DevOps ì—”ì§€ë‹ˆì–´:
  - ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ê´€ë¦¬
  - ë°°í¬ ë° ë¦´ë¦¬ì¦ˆ ê´€ë¦¬
  - ì¸í”„ë¼ ìë™í™” ë° ìŠ¤ì¼€ì¼ë§
  - ì„±ëŠ¥ ìµœì í™”

SRE (Site Reliability Engineer):
  - ì‹œìŠ¤í…œ ì‹ ë¢°ì„± ë° ê°€ìš©ì„± ê´€ë¦¬
  - ì¥ì•  ëŒ€ì‘ ë° ê·¼ë³¸ ì›ì¸ ë¶„ì„
  - ì„œë¹„ìŠ¤ ë ˆë²¨ ëª©í‘œ(SLO) ê´€ë¦¬
  - ì¬í•´ ë³µêµ¬ ê³„íš ìˆ˜ë¦½

ë³´ì•ˆ ì—”ì§€ë‹ˆì–´:
  - ë³´ì•ˆ ì •ì±… ìˆ˜ë¦½ ë° ì‹œí–‰
  - ì·¨ì•½ì  ë¶„ì„ ë° ë³´ì•ˆ íŒ¨ì¹˜
  - ì ‘ê·¼ ì œì–´ ë° ê°ì‚¬
  - ë³´ì•ˆ ì‚¬ê³  ëŒ€ì‘

ë°ì´í„° ì—”ì§€ë‹ˆì–´:
  - ë°ì´í„° íŒŒì´í”„ë¼ì¸ ê´€ë¦¬
  - ë°ì´í„° í’ˆì§ˆ ë° ë¬´ê²°ì„± ë³´ì¥
  - ë°±ì—… ë° ì•„ì¹´ì´ë¸Œ ê´€ë¦¬
  - ë¶„ì„ ë° ë¦¬í¬íŒ… ì§€ì›
```

### ìš´ì˜ ì‹œê°„ ë° ì§€ì›

#### ì§€ì› ê³„ì¸µ
```yaml
Tier 1 (L1) - ê¸°ë³¸ ì§€ì›:
  - ìš´ì˜ì‹œê°„: 24/7
  - ëŒ€ì‘ì‹œê°„: 15ë¶„ ì´ë‚´
  - ë‹´ë‹¹: ìš´ì˜ ì„¼í„°
  - ë²”ìœ„: ê¸°ë³¸ ëª¨ë‹ˆí„°ë§, ì•Œë¦¼ ëŒ€ì‘, ì´ˆê¸° ë¬¸ì œ ë¶„ë¥˜

Tier 2 (L2) - ê¸°ìˆ  ì§€ì›:
  - ìš´ì˜ì‹œê°„: í‰ì¼ 09:00-18:00, ì£¼ë§ ëŒ€ê¸°
  - ëŒ€ì‘ì‹œê°„: 30ë¶„ ì´ë‚´
  - ë‹´ë‹¹: DevOps/SRE íŒ€
  - ë²”ìœ„: ì‹œìŠ¤í…œ ë¬¸ì œ í•´ê²°, ì„±ëŠ¥ ë¶„ì„, ë°°í¬ ì§€ì›

Tier 3 (L3) - ì „ë¬¸ê°€ ì§€ì›:
  - ìš´ì˜ì‹œê°„: í‰ì¼ 09:00-18:00
  - ëŒ€ì‘ì‹œê°„: 2ì‹œê°„ ì´ë‚´
  - ë‹´ë‹¹: ì•„í‚¤í…íŠ¸, ê°œë°œíŒ€
  - ë²”ìœ„: ë³µì¡í•œ ë¬¸ì œ í•´ê²°, ì•„í‚¤í…ì²˜ ë³€ê²½, ê¸´ê¸‰ íŒ¨ì¹˜
```

### ì„œë¹„ìŠ¤ ë ˆë²¨ ëª©í‘œ (SLO)

#### ê°€ìš©ì„± ëª©í‘œ
```yaml
Critical Services (API, Auth):
  - ê°€ìš©ì„±: 99.9% (ì›” 43ë¶„ ë‹¤ìš´íƒ€ì„)
  - ì‘ë‹µì‹œê°„: P95 < 200ms, P99 < 500ms
  - ì—ëŸ¬ìœ¨: < 0.1%

Important Services (Dashboard, Analytics):
  - ê°€ìš©ì„±: 99.5% (ì›” 3.6ì‹œê°„ ë‹¤ìš´íƒ€ì„)
  - ì‘ë‹µì‹œê°„: P95 < 1s, P99 < 3s
  - ì—ëŸ¬ìœ¨: < 0.5%

Supporting Services (Monitoring, Logging):
  - ê°€ìš©ì„±: 99.0% (ì›” 7.2ì‹œê°„ ë‹¤ìš´íƒ€ì„)
  - ë°ì´í„° ì†ì‹¤: < 0.01%
  - ë³µêµ¬ ì‹œê°„: < 15ë¶„
```

## ğŸ“… ì¼ìƒ ìš´ì˜ ì‘ì—…

### ì¼ì¼ ì ê²€ ì‘ì—…

#### ì‹œìŠ¤í…œ ìƒíƒœ ì ê²€ (ë§¤ì¼ 09:00)
```bash
#!/bin/bash
# ì¼ì¼ ì‹œìŠ¤í…œ ì ê²€ ìŠ¤í¬ë¦½íŠ¸

echo "ğŸŒ… $(date) - ì¼ì¼ ì‹œìŠ¤í…œ ì ê²€ ì‹œì‘"

# 1. í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
echo "ğŸ“Š Kubernetes í´ëŸ¬ìŠ¤í„° ìƒíƒœ:"
kubectl get nodes -o wide
kubectl get pods --all-namespaces | grep -v Running | grep -v Completed

# 2. ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
echo "ğŸ’» ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰:"
kubectl top nodes
kubectl top pods -A --sort-by=memory | head -10

# 3. ì €ì¥ì†Œ ì‚¬ìš©ëŸ‰ í™•ì¸
echo "ğŸ’¾ ì €ì¥ì†Œ ì‚¬ìš©ëŸ‰:"
kubectl get pvc -A
df -h | grep -E '(8[0-9]|9[0-9])%'

# 4. ì£¼ìš” ì„œë¹„ìŠ¤ ìƒíƒœ
echo "ğŸ” ì£¼ìš” ì„œë¹„ìŠ¤ Health Check:"
services=(
  "https://api.hankook-smartsensor.com/health"
  "https://hankook-smartsensor.com/health"
  "http://prometheus.monitoring.svc.cluster.local:9090/-/healthy"
)

for service in "${services[@]}"; do
  if curl -s --max-time 10 "$service" > /dev/null; then
    echo "  âœ… $service"
  else
    echo "  âŒ $service"
  fi
done

# 5. ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ
echo "ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸:"
kubectl exec -n hankook-smartsensor postgresql-cluster-0 -- \
  psql -U postgres -c "SELECT 1;" > /dev/null && echo "  âœ… PostgreSQL" || echo "  âŒ PostgreSQL"

kubectl exec -n hankook-smartsensor redis-cluster-0 -- \
  redis-cli ping | grep PONG > /dev/null && echo "  âœ… Redis" || echo "  âŒ Redis"

# 6. ë°±ì—… ìƒíƒœ í™•ì¸
echo "ğŸ’¾ ë°±ì—… ìƒíƒœ:"
velero backup get | head -5

echo "âœ… ì¼ì¼ ì ê²€ ì™„ë£Œ: $(date)"
```

#### ë¡œê·¸ ê²€í†  (ë§¤ì¼ 10:00)
```bash
#!/bin/bash
# ì¼ì¼ ë¡œê·¸ ê²€í†  ìŠ¤í¬ë¦½íŠ¸

echo "ğŸ“‹ ì¼ì¼ ë¡œê·¸ ê²€í†  ì‹œì‘: $(date)"

# 1. ì—ëŸ¬ ë¡œê·¸ ìˆ˜ì§‘ (ì§€ë‚œ 24ì‹œê°„)
echo "âŒ ì§€ë‚œ 24ì‹œê°„ ì—ëŸ¬ ë¡œê·¸:"
kubectl logs --since=24h -l app=api-server -n hankook-smartsensor | grep -i error | tail -20

# 2. ì„±ëŠ¥ ê´€ë ¨ ë¡œê·¸
echo "âš¡ ëŠë¦° ì‘ë‹µ ê°ì§€:"
kubectl logs --since=24h -l app=api-server -n hankook-smartsensor | \
  grep "response_time" | awk '$NF > 1000' | tail -10

# 3. ë³´ì•ˆ ê´€ë ¨ ë¡œê·¸
echo "ğŸ”’ ë³´ì•ˆ ì´ë²¤íŠ¸:"
kubectl logs --since=24h -l app=oauth2-server -n hankook-security | \
  grep -E "(failed|unauthorized|blocked)" | tail -10

# 4. ì„¼ì„œ ë°ì´í„° í’ˆì§ˆ í™•ì¸
echo "ğŸ“Š ì„¼ì„œ ë°ì´í„° í’ˆì§ˆ:"
kubectl exec -n hankook-smartsensor postgresql-cluster-0 -- \
  psql -U postgres -d hankook_sensors -c "
    SELECT 
      DATE(timestamp) as date,
      COUNT(*) as total_readings,
      COUNT(CASE WHEN value IS NULL THEN 1 END) as null_readings,
      ROUND(AVG(value), 2) as avg_value
    FROM sensors.sensor_data 
    WHERE timestamp >= NOW() - INTERVAL '24 hours'
    GROUP BY DATE(timestamp)
    ORDER BY date DESC
    LIMIT 7;
  "

echo "âœ… ë¡œê·¸ ê²€í†  ì™„ë£Œ: $(date)"
```

### ì£¼ê°„ ì ê²€ ì‘ì—…

#### ì‹œìŠ¤í…œ ìµœì í™” (ë§¤ì£¼ ì¼ìš”ì¼ 02:00)
```bash
#!/bin/bash
# ì£¼ê°„ ì‹œìŠ¤í…œ ìµœì í™” ìŠ¤í¬ë¦½íŠ¸

echo "ğŸ”§ ì£¼ê°„ ì‹œìŠ¤í…œ ìµœì í™” ì‹œì‘: $(date)"

# 1. ë°ì´í„°ë² ì´ìŠ¤ ì •ë¦¬
echo "ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”:"
kubectl exec -n hankook-smartsensor postgresql-cluster-0 -- \
  psql -U postgres -d hankook_sensors -c "
    -- ì˜¤ë˜ëœ ì„¼ì„œ ë°ì´í„° ì •ë¦¬ (90ì¼ ì´ìƒ)
    DELETE FROM sensors.sensor_data 
    WHERE timestamp < NOW() - INTERVAL '90 days';
    
    -- í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸
    ANALYZE;
    
    -- ì¸ë±ìŠ¤ ì¬êµ¬ì„±
    REINDEX DATABASE hankook_sensors;
  "

# 2. ë¡œê·¸ ì •ë¦¬
echo "ğŸ“‹ ë¡œê·¸ ì •ë¦¬:"
# Elasticsearch ì˜¤ë˜ëœ ì¸ë±ìŠ¤ ì‚­ì œ (30ì¼ ì´ìƒ)
kubectl exec -n monitoring elasticsearch-0 -- \
  curl -X DELETE "localhost:9200/logstash-$(date -d '30 days ago' '+%Y.%m.%d')"

# 3. ì´ë¯¸ì§€ ì •ë¦¬
echo "ğŸ–¼ï¸ Docker ì´ë¯¸ì§€ ì •ë¦¬:"
kubectl get nodes -o name | xargs -I {} kubectl debug {} -it --image=alpine -- \
  sh -c "nsenter -t 1 -m -u -n -i -p -- docker system prune -f"

# 4. ë©”íŠ¸ë¦­ ì••ì¶•
echo "ğŸ“Š ë©”íŠ¸ë¦­ ë°ì´í„° ì••ì¶•:"
kubectl exec -n monitoring prometheus-0 -- \
  promtool tsdb create-blocks-from-rules --label=prometheus=kube-prometheus-stack-prometheus \
  /prometheus/rules /prometheus/data

echo "âœ… ì£¼ê°„ ìµœì í™” ì™„ë£Œ: $(date)"
```

### ì›”ê°„ ì ê²€ ì‘ì—…

#### ë³´ì•ˆ ê°ì‚¬ (ë§¤ì›” ì²«ì§¸ ì›”ìš”ì¼)
```bash
#!/bin/bash
# ì›”ê°„ ë³´ì•ˆ ê°ì‚¬ ìŠ¤í¬ë¦½íŠ¸

echo "ğŸ” ì›”ê°„ ë³´ì•ˆ ê°ì‚¬ ì‹œì‘: $(date)"

# 1. ì¸ì¦ì„œ ë§Œë£Œ í™•ì¸
echo "ğŸ“œ SSL/TLS ì¸ì¦ì„œ ìƒíƒœ:"
kubectl get certificates -A -o custom-columns=\
  "NAMESPACE:.metadata.namespace,NAME:.metadata.name,READY:.status.conditions[0].status,AGE:.metadata.creationTimestamp"

# 2. ê¶Œí•œ ê²€í† 
echo "ğŸ‘¥ RBAC ê¶Œí•œ ê²€í† :"
kubectl get clusterrolebindings -o wide | grep -v system:

# 3. ë³´ì•ˆ ìŠ¤ìº”
echo "ğŸ” ë³´ì•ˆ ì·¨ì•½ì  ìŠ¤ìº”:"
# Trivyë¥¼ ì‚¬ìš©í•œ ì´ë¯¸ì§€ ìŠ¤ìº”
trivy image --severity HIGH,CRITICAL hankook/api-server:latest

# 4. ë„¤íŠ¸ì›Œí¬ ì •ì±… í™•ì¸
echo "ğŸŒ ë„¤íŠ¸ì›Œí¬ ì •ì±… ìƒíƒœ:"
kubectl get networkpolicies -A

# 5. ë¹„ë°€ë²ˆí˜¸ ì •ì±… í™•ì¸
echo "ğŸ”‘ ì‚¬ìš©ì ê³„ì • ë³´ì•ˆ ìƒíƒœ:"
kubectl exec -n hankook-security oauth2-server-0 -- \
  python3 -c "
import sys
sys.path.append('/app')
from security_audit import check_user_security
check_user_security()
"

echo "âœ… ë³´ì•ˆ ê°ì‚¬ ì™„ë£Œ: $(date)"
```

## ğŸ“Š ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§

### Prometheus ë©”íŠ¸ë¦­ ì„¤ì •

#### ì£¼ìš” ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­
```yaml
# prometheus-rules.yaml
groups:
- name: hankook_smartsensor_alerts
  rules:
  
  # API ì„œë²„ ë©”íŠ¸ë¦­
  - alert: APIHighResponseTime
    expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.5
    for: 2m
    labels:
      severity: warning
      team: backend
    annotations:
      summary: "API ì‘ë‹µ ì‹œê°„ ì¦ê°€"
      description: "API ì„œë²„ì˜ 95%ile ì‘ë‹µ ì‹œê°„ì´ {{ $value }}ì´ˆë¡œ ì„ê³„ê°’ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."

  - alert: APIErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.01
    for: 1m
    labels:
      severity: critical
      team: backend
    annotations:
      summary: "API ì—ëŸ¬ìœ¨ ì¦ê°€"
      description: "API ì„œë²„ì˜ ì—ëŸ¬ìœ¨ì´ {{ $value }}%ë¡œ ì„ê³„ê°’ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."

  # ë°ì´í„°ë² ì´ìŠ¤ ë©”íŠ¸ë¦­
  - alert: DatabaseConnectionsHigh
    expr: pg_stat_database_numbackends / pg_settings_max_connections > 0.8
    for: 5m
    labels:
      severity: warning
      team: data
    annotations:
      summary: "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìˆ˜ ë†’ìŒ"
      description: "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìˆ˜ê°€ ìµœëŒ€ê°’ì˜ 80%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."

  - alert: DatabaseSlowQueries
    expr: pg_stat_statements_mean_time_ms > 1000
    for: 2m
    labels:
      severity: warning
      team: data
    annotations:
      summary: "ë°ì´í„°ë² ì´ìŠ¤ ëŠë¦° ì¿¼ë¦¬ ê°ì§€"
      description: "í‰ê·  ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ì´ {{ $value }}msë¡œ ì„ê³„ê°’ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."

  # ì„¼ì„œ ë°ì´í„° ë©”íŠ¸ë¦­
  - alert: SensorDataIngestionRate
    expr: rate(sensor_data_received_total[5m]) < 100
    for: 5m
    labels:
      severity: critical
      team: iot
    annotations:
      summary: "ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘ ê°ì†Œ"
      description: "ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘ìœ¨ì´ {{ $value }}/ì´ˆë¡œ ì •ìƒ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤."

  - alert: SensorDataQuality
    expr: sensor_data_error_rate > 0.05
    for: 3m
    labels:
      severity: warning
      team: iot
    annotations:
      summary: "ì„¼ì„œ ë°ì´í„° í’ˆì§ˆ ì €í•˜"
      description: "ì„¼ì„œ ë°ì´í„° ì˜¤ë¥˜ìœ¨ì´ {{ $value }}%ë¡œ ì„ê³„ê°’ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."
```

### Grafana ëŒ€ì‹œë³´ë“œ

#### ì‹œìŠ¤í…œ ê°œìš” ëŒ€ì‹œë³´ë“œ
```json
{
  "dashboard": {
    "title": "HankookTire SmartSensor 2.0 - System Overview",
    "panels": [
      {
        "title": "API ìš”ì²­ë¥ ",
        "type": "stat",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total[5m]))",
            "legendFormat": "Requests/sec"
          }
        ]
      },
      {
        "title": "ì‘ë‹µ ì‹œê°„ ë¶„í¬",
        "type": "heatmap",
        "targets": [
          {
            "expr": "rate(http_request_duration_seconds_bucket[5m])"
          }
        ]
      },
      {
        "title": "í™œì„± ì°¨ëŸ‰ ìˆ˜",
        "type": "stat",
        "targets": [
          {
            "expr": "active_vehicles_total"
          }
        ]
      },
      {
        "title": "ì„¼ì„œ ë°ì´í„° ìˆ˜ì§‘ë¥ ",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(sensor_data_received_total[5m])",
            "legendFormat": "Data points/sec"
          }
        ]
      }
    ]
  }
}
```

### ë¡œê·¸ ë¶„ì„

#### ELK ìŠ¤íƒ ë¡œê·¸ íŒŒì´í”„ë¼ì¸
```yaml
# logstash-config.yaml
input {
  beats {
    port => 5044
  }
}

filter {
  if [kubernetes][labels][app] == "api-server" {
    grok {
      match => { 
        "message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} \[%{DATA:thread}\] %{DATA:logger}: %{GREEDYDATA:message}"
      }
    }
    
    if [message] =~ /response_time/ {
      grok {
        match => {
          "message" => "response_time=%{NUMBER:response_time:float}ms"
        }
      }
    }
    
    if [response_time] and [response_time] > 1000 {
      mutate {
        add_tag => ["slow_response"]
      }
    }
  }
  
  if [kubernetes][labels][app] == "sensor-gateway" {
    json {
      source => "message"
    }
    
    if [sensor_data][quality] == "poor" {
      mutate {
        add_tag => ["data_quality_issue"]
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch-0:9200", "elasticsearch-1:9200"]
    index => "hankook-smartsensor-%{+YYYY.MM.dd}"
  }
}
```

## âš¡ ì„±ëŠ¥ ê´€ë¦¬

### ìë™ ìŠ¤ì¼€ì¼ë§ ì„¤ì •

#### Horizontal Pod Autoscaler (HPA)
```yaml
# api-server-hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: api-server-hpa
  namespace: hankook-smartsensor
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: api-server
  minReplicas: 3
  maxReplicas: 20
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  - type: Pods
    pods:
      metric:
        name: http_requests_per_second
      target:
        type: AverageValue
        averageValue: "30"
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 100
        periodSeconds: 15
      - type: Pods
        value: 4
        periodSeconds: 60
      selectPolicy: Max
```

#### Vertical Pod Autoscaler (VPA)
```yaml
# database-vpa.yaml
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: postgresql-vpa
  namespace: hankook-smartsensor
spec:
  targetRef:
    apiVersion: apps/v1
    kind: StatefulSet
    name: postgresql-cluster
  updatePolicy:
    updateMode: "Auto"
  resourcePolicy:
    containerPolicies:
    - containerName: postgresql
      minAllowed:
        cpu: 500m
        memory: 1Gi
      maxAllowed:
        cpu: 4
        memory: 16Gi
      controlledResources: ["cpu", "memory"]
      controlledValues: RequestsAndLimits
```

### ì„±ëŠ¥ ìµœì í™” ì‘ì—…

#### ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ íŠœë‹
```sql
-- PostgreSQL ì„±ëŠ¥ ìµœì í™” ì¿¼ë¦¬

-- 1. ëŠë¦° ì¿¼ë¦¬ ë¶„ì„
SELECT 
    query,
    calls,
    total_time,
    mean_time,
    (total_time/sum(total_time) OVER()) * 100 AS percentage
FROM pg_stat_statements 
WHERE mean_time > 100
ORDER BY total_time DESC
LIMIT 20;

-- 2. ì¸ë±ìŠ¤ ì‚¬ìš©ë¥  ë¶„ì„
SELECT 
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch,
    pg_size_pretty(pg_relation_size(indexrelid)) AS size
FROM pg_stat_user_indexes
WHERE idx_scan < 100  -- ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì¸ë±ìŠ¤
ORDER BY pg_relation_size(indexrelid) DESC;

-- 3. í…Œì´ë¸” í†µê³„ ì—…ë°ì´íŠ¸
ANALYZE;

-- 4. ìë™ VACUUM ì„¤ì • ìµœì í™”
ALTER TABLE sensors.sensor_data SET (
    autovacuum_vacuum_scale_factor = 0.1,
    autovacuum_analyze_scale_factor = 0.05,
    autovacuum_vacuum_cost_delay = 10
);
```

#### ìºì‹œ ìµœì í™”
```bash
#!/bin/bash
# Redis ìºì‹œ ìµœì í™” ìŠ¤í¬ë¦½íŠ¸

echo "ğŸ”„ Redis ìºì‹œ ìµœì í™” ì‹œì‘"

# 1. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl exec -n hankook-smartsensor redis-cluster-0 -- redis-cli INFO memory

# 2. í‚¤ ë¶„ì„
kubectl exec -n hankook-smartsensor redis-cluster-0 -- redis-cli --bigkeys

# 3. ë§Œë£Œëœ í‚¤ ì •ë¦¬
kubectl exec -n hankook-smartsensor redis-cluster-0 -- redis-cli FLUSHDB

# 4. ìºì‹œ íˆíŠ¸ìœ¨ í™•ì¸
kubectl exec -n hankook-smartsensor redis-cluster-0 -- redis-cli INFO stats | grep cache

echo "âœ… Redis ìºì‹œ ìµœì í™” ì™„ë£Œ"
```

### ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

#### ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ ì§€í‘œ
```yaml
# application-performance.json
{
  "dashboard": {
    "title": "Application Performance Monitoring",
    "panels": [
      {
        "title": "ì‘ë‹µ ì‹œê°„ P95/P99",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "P95"
          },
          {
            "expr": "histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "P99"
          }
        ]
      },
      {
        "title": "ì²˜ë¦¬ëŸ‰ (RPS)",
        "targets": [
          {
            "expr": "sum(rate(http_requests_total[5m]))",
            "legendFormat": "Requests/sec"
          }
        ]
      },
      {
        "title": "ì—ëŸ¬ìœ¨",
        "targets": [
          {
            "expr": "rate(http_requests_total{status=~\"5..\"}[5m]) / rate(http_requests_total[5m]) * 100",
            "legendFormat": "Error rate %"
          }
        ]
      }
    ]
  }
}
```

## ğŸ’¾ ë°±ì—… ë° ë³µêµ¬

### ë°±ì—… ì „ëµ

#### ë°ì´í„° ë°±ì—… ìŠ¤ì¼€ì¤„
```yaml
# velero-backup-schedule.yaml
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: hankook-smartsensor-backup
  namespace: velero
spec:
  schedule: "0 2 * * *"  # ë§¤ì¼ 02:00
  template:
    metadata:
      labels:
        backup-type: daily
    spec:
      includedNamespaces:
      - hankook-smartsensor
      - hankook-security
      - monitoring
      excludedResources:
      - events
      - events.events.k8s.io
      storageLocation: default
      volumeSnapshotLocations:
      - default
      ttl: 720h0m0s  # 30ì¼ ë³´ê´€
```

#### ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
```bash
#!/bin/bash
# PostgreSQL ë°±ì—… ìŠ¤í¬ë¦½íŠ¸

BACKUP_DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups/postgresql"
RETENTION_DAYS=30

echo "ğŸ“¦ PostgreSQL ë°±ì—… ì‹œì‘: $BACKUP_DATE"

# 1. ë°ì´í„°ë² ì´ìŠ¤ ë¤í”„
kubectl exec -n hankook-smartsensor postgresql-cluster-0 -- \
  pg_dumpall -U postgres | gzip > "$BACKUP_DIR/postgresql_backup_$BACKUP_DATE.sql.gz"

# 2. WAL íŒŒì¼ ë°±ì—…
kubectl exec -n hankook-smartsensor postgresql-cluster-0 -- \
  tar -czf - /var/lib/postgresql/data/pg_wal/ > "$BACKUP_DIR/wal_backup_$BACKUP_DATE.tar.gz"

# 3. ì„¤ì • íŒŒì¼ ë°±ì—…
kubectl get configmap postgresql-config -n hankook-smartsensor -o yaml > \
  "$BACKUP_DIR/postgresql_config_$BACKUP_DATE.yaml"

# 4. ì˜¤ë˜ëœ ë°±ì—… ì •ë¦¬
find "$BACKUP_DIR" -name "*.gz" -mtime +$RETENTION_DAYS -delete

# 5. ë°±ì—… ê²€ì¦
if [ -f "$BACKUP_DIR/postgresql_backup_$BACKUP_DATE.sql.gz" ]; then
  echo "âœ… PostgreSQL ë°±ì—… ì™„ë£Œ: postgresql_backup_$BACKUP_DATE.sql.gz"
else
  echo "âŒ PostgreSQL ë°±ì—… ì‹¤íŒ¨"
  exit 1
fi

# 6. í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ì— ì—…ë¡œë“œ
aws s3 cp "$BACKUP_DIR/postgresql_backup_$BACKUP_DATE.sql.gz" \
  s3://hankook-smartsensor-backups/postgresql/

echo "ğŸ“¤ ë°±ì—… íŒŒì¼ í´ë¼ìš°ë“œ ì—…ë¡œë“œ ì™„ë£Œ"
```

### ì¬í•´ ë³µêµ¬ ì ˆì°¨

#### ì „ì²´ ì‹œìŠ¤í…œ ë³µêµ¬
```bash
#!/bin/bash
# ì¬í•´ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸

BACKUP_DATE=${1:-latest}
echo "ğŸš‘ ì¬í•´ ë³µêµ¬ ì‹œì‘: $BACKUP_DATE"

# 1. í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
if ! kubectl cluster-info > /dev/null 2>&1; then
  echo "âŒ Kubernetes í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
  exit 1
fi

# 2. ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¬ìƒì„±
kubectl create namespace hankook-smartsensor --dry-run=client -o yaml | kubectl apply -f -
kubectl create namespace hankook-security --dry-run=client -o yaml | kubectl apply -f -
kubectl create namespace monitoring --dry-run=client -o yaml | kubectl apply -f -

# 3. Veleroë¥¼ ì‚¬ìš©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³µêµ¬
if [ "$BACKUP_DATE" = "latest" ]; then
  BACKUP_NAME=$(velero backup get | grep Completed | head -1 | awk '{print $1}')
else
  BACKUP_NAME="hankook-smartsensor-backup-$BACKUP_DATE"
fi

echo "ğŸ“¦ ë°±ì—…ì—ì„œ ë³µêµ¬ ì¤‘: $BACKUP_NAME"
velero restore create --from-backup $BACKUP_NAME --wait

# 4. ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬
echo "ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë³µêµ¬ ì¤‘..."
kubectl apply -f deployment/databases/postgresql-cluster.yaml

# PostgreSQL ì¤€ë¹„ ëŒ€ê¸°
kubectl wait --for=condition=ready pod/postgresql-cluster-0 -n hankook-smartsensor --timeout=300s

# ë°±ì—…ëœ ë°ì´í„° ë³µì›
aws s3 cp s3://hankook-smartsensor-backups/postgresql/postgresql_backup_$BACKUP_DATE.sql.gz /tmp/
gunzip /tmp/postgresql_backup_$BACKUP_DATE.sql.gz

kubectl exec -i -n hankook-smartsensor postgresql-cluster-0 -- \
  psql -U postgres < /tmp/postgresql_backup_$BACKUP_DATE.sql

# 5. ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
echo "ğŸ” ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ ì¤‘..."
kubectl get pods -A | grep -v Running | grep -v Completed

# 6. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
echo "ğŸ§ª ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
curl -f https://api.hankook-smartsensor.com/health || echo "âŒ API ì„œë²„ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"
curl -f https://hankook-smartsensor.com || echo "âŒ ì›¹ ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"

echo "âœ… ì¬í•´ ë³µêµ¬ ì™„ë£Œ: $(date)"
```

### ë°±ì—… ê²€ì¦

#### ì •ê¸° ë°±ì—… í…ŒìŠ¤íŠ¸
```bash
#!/bin/bash
# ë°±ì—… ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ (ë§¤ì£¼ ì‹¤í–‰)

echo "ğŸ” ë°±ì—… ê²€ì¦ ì‹œì‘: $(date)"

# 1. ìµœì‹  ë°±ì—… íŒŒì¼ í™•ì¸
LATEST_BACKUP=$(ls -t /backups/postgresql/postgresql_backup_*.sql.gz | head -1)
if [ -z "$LATEST_BACKUP" ]; then
  echo "âŒ ë°±ì—… íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
  exit 1
fi

echo "ğŸ“¦ ê²€ì¦í•  ë°±ì—…: $LATEST_BACKUP"

# 2. í…ŒìŠ¤íŠ¸ í™˜ê²½ì— ë³µì›
TEST_NAMESPACE="backup-test-$(date +%s)"
kubectl create namespace $TEST_NAMESPACE

# í…ŒìŠ¤íŠ¸ìš© PostgreSQL ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
kubectl apply -f - <<EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: postgres-test
  namespace: $TEST_NAMESPACE
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgres-test
  template:
    metadata:
      labels:
        app: postgres-test
    spec:
      containers:
      - name: postgres
        image: postgres:13
        env:
        - name: POSTGRES_PASSWORD
          value: testpassword
        - name: PGDATA
          value: /var/lib/postgresql/data/pgdata
        volumeMounts:
        - name: postgres-storage
          mountPath: /var/lib/postgresql/data
      volumes:
      - name: postgres-storage
        emptyDir: {}
EOF

# Pod ì¤€ë¹„ ëŒ€ê¸°
kubectl wait --for=condition=ready pod -l app=postgres-test -n $TEST_NAMESPACE --timeout=300s

# 3. ë°±ì—… ë°ì´í„° ë³µì› í…ŒìŠ¤íŠ¸
echo "ğŸ”„ ë°±ì—… ë°ì´í„° ë³µì› í…ŒìŠ¤íŠ¸ ì¤‘..."
gunzip -c "$LATEST_BACKUP" | kubectl exec -i -n $TEST_NAMESPACE \
  deployment/postgres-test -- psql -U postgres

# 4. ë°ì´í„° ë¬´ê²°ì„± í™•ì¸
RECORD_COUNT=$(kubectl exec -n $TEST_NAMESPACE deployment/postgres-test -- \
  psql -U postgres -d hankook_sensors -t -c "SELECT COUNT(*) FROM sensors.sensor_data;")

echo "ğŸ“Š ë³µì›ëœ ë ˆì½”ë“œ ìˆ˜: $RECORD_COUNT"

if [ "$RECORD_COUNT" -gt 0 ]; then
  echo "âœ… ë°±ì—… ê²€ì¦ ì„±ê³µ"
else
  echo "âŒ ë°±ì—… ê²€ì¦ ì‹¤íŒ¨: ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤"
fi

# 5. ì •ë¦¬
kubectl delete namespace $TEST_NAMESPACE

echo "ğŸ ë°±ì—… ê²€ì¦ ì™„ë£Œ: $(date)"
```

## ğŸ”’ ë³´ì•ˆ ê´€ë¦¬

### ë³´ì•ˆ ì •ì±… ê´€ë¦¬

#### Pod Security Standards
```yaml
# pod-security-policy.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: hankook-smartsensor
  labels:
    pod-security.kubernetes.io/enforce: restricted
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/warn: restricted
---
apiVersion: v1
kind: Namespace
metadata:
  name: hankook-security
  labels:
    pod-security.kubernetes.io/enforce: restricted
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/warn: restricted
```

#### Network Policies
```yaml
# network-policies.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: hankook-smartsensor
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-api-server
  namespace: hankook-smartsensor
spec:
  podSelector:
    matchLabels:
      app: api-server
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    - podSelector:
        matchLabels:
          app: web-dashboard
    ports:
    - protocol: TCP
      port: 8000
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: postgresql
    ports:
    - protocol: TCP
      port: 5432
  - to:
    - podSelector:
        matchLabels:
          app: redis
    ports:
    - protocol: TCP
      port: 6379
```

### ì·¨ì•½ì  ê´€ë¦¬

#### ì •ê¸° ë³´ì•ˆ ìŠ¤ìº”
```bash
#!/bin/bash
# ë³´ì•ˆ ìŠ¤ìº” ìŠ¤í¬ë¦½íŠ¸

echo "ğŸ” ì •ê¸° ë³´ì•ˆ ìŠ¤ìº” ì‹œì‘: $(date)"

# 1. ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì·¨ì•½ì  ìŠ¤ìº”
IMAGES=(
  "hankook/api-server:latest"
  "hankook/web-dashboard:latest"
  "hankook/sensor-gateway:latest"
  "hankook/analytics-engine:latest"
)

for image in "${IMAGES[@]}"; do
  echo "ğŸ–¼ï¸ ì´ë¯¸ì§€ ìŠ¤ìº” ì¤‘: $image"
  trivy image --severity HIGH,CRITICAL --format json $image > "scan_results_$(echo $image | tr '/:' '_').json"
done

# 2. Kubernetes í´ëŸ¬ìŠ¤í„° ë³´ì•ˆ ìŠ¤ìº”
echo "â˜¸ï¸ Kubernetes í´ëŸ¬ìŠ¤í„° ìŠ¤ìº” ì¤‘..."
kube-bench run --targets master,node --outputfile kube-bench-results.json --json

# 3. ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ìŠ¤ìº”
echo "ğŸŒ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ìŠ¤ìº” ì¤‘..."
nmap -sS -O hankook-smartsensor.com > network-scan-results.txt

# 4. ì„¤ì • ë³´ì•ˆ ìŠ¤ìº”
echo "âš™ï¸ ì„¤ì • ë³´ì•ˆ ìŠ¤ìº” ì¤‘..."
# Falcoë¥¼ ì‚¬ìš©í•œ ëŸ°íƒ€ì„ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§
kubectl logs -n kube-system -l app=falco --since=24h | grep -i "warning\|error" > falco-alerts.log

# 5. ê²°ê³¼ ë¶„ì„ ë° ë¦¬í¬íŠ¸ ìƒì„±
echo "ğŸ“‹ ë³´ì•ˆ ìŠ¤ìº” ë¦¬í¬íŠ¸ ìƒì„± ì¤‘..."
python3 security_report_generator.py \
  --trivy-results scan_results_*.json \
  --kube-bench kube-bench-results.json \
  --network-scan network-scan-results.txt \
  --falco-alerts falco-alerts.log \
  --output security-report-$(date +%Y%m%d).html

echo "âœ… ë³´ì•ˆ ìŠ¤ìº” ì™„ë£Œ. ë¦¬í¬íŠ¸: security-report-$(date +%Y%m%d).html"
```

### ì•¡ì„¸ìŠ¤ ê´€ë¦¬

#### ì‚¬ìš©ì ì•¡ì„¸ìŠ¤ ê²€í† 
```bash
#!/bin/bash
# ì‚¬ìš©ì ì•¡ì„¸ìŠ¤ ê²€í†  ìŠ¤í¬ë¦½íŠ¸

echo "ğŸ‘¥ ì‚¬ìš©ì ì•¡ì„¸ìŠ¤ ê²€í†  ì‹œì‘: $(date)"

# 1. í™œì„± ì‚¬ìš©ì ëª©ë¡
echo "ğŸ“‹ í™œì„± ì‚¬ìš©ì ëª©ë¡:"
kubectl get rolebindings,clusterrolebindings -A -o wide | \
  grep -v system: | awk '{print $1, $3, $4}' | sort | uniq

# 2. ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤ ìƒì„±
echo "ğŸ” ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤:"
users=(admin operator viewer)
for user in "${users[@]}"; do
  echo "ì‚¬ìš©ì: $user"
  kubectl auth can-i --list --as=$user | head -10
done

# 3. ë§ˆì§€ë§‰ ë¡œê·¸ì¸ í™•ì¸
echo "ğŸ• ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„:"
kubectl logs -n hankook-security oauth2-server-0 --since=720h | \
  grep "login_success" | tail -20

# 4. ë¹„í™œì„± ê³„ì • í™•ì¸
echo "ğŸ˜´ ë¹„í™œì„± ê³„ì • (90ì¼ ì´ìƒ ë¯¸ì‚¬ìš©):"
python3 -c "
import json
import datetime
from kubernetes import client, config

config.load_incluster_config()
v1 = client.CoreV1Api()

# ì‚¬ìš©ìë³„ ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ ì¡°íšŒ
# (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” audit ë¡œê·¸ ë¶„ì„)
inactive_users = []
cutoff_date = datetime.datetime.now() - datetime.timedelta(days=90)

# ê²°ê³¼ ì¶œë ¥
for user in inactive_users:
    print(f'{user[\"username\"]} - ë§ˆì§€ë§‰ í™œë™: {user[\"last_activity\"]}')
"

echo "âœ… ì‚¬ìš©ì ì•¡ì„¸ìŠ¤ ê²€í†  ì™„ë£Œ: $(date)"
```

## ğŸš¨ ì¥ì•  ëŒ€ì‘

### ì¥ì•  ëŒ€ì‘ ì ˆì°¨

#### ì¸ì‹œë˜íŠ¸ ëŒ€ì‘ í”Œë ˆì´ë¶
```yaml
# incident-response-playbook.yaml
incident_levels:
  P1_Critical:
    description: "ì„œë¹„ìŠ¤ ì™„ì „ ì¤‘ë‹¨ ë˜ëŠ” ì‹¬ê°í•œ ë³´ì•ˆ ì¹¨í•´"
    response_time: "15ë¶„ ì´ë‚´"
    escalation_time: "30ë¶„"
    team: ["L1", "L2", "L3", "Management"]
    
  P2_High:
    description: "ì£¼ìš” ê¸°ëŠ¥ ì¥ì•  ë˜ëŠ” ì„±ëŠ¥ ì‹¬ê°í•œ ì €í•˜"
    response_time: "30ë¶„ ì´ë‚´"
    escalation_time: "1ì‹œê°„"
    team: ["L1", "L2"]
    
  P3_Medium:
    description: "ì¼ë¶€ ê¸°ëŠ¥ ì¥ì•  ë˜ëŠ” ì„±ëŠ¥ ì €í•˜"
    response_time: "2ì‹œê°„ ì´ë‚´"
    escalation_time: "4ì‹œê°„"
    team: ["L1", "L2"]
    
  P4_Low:
    description: "ê²½ë¯¸í•œ ë¬¸ì œ ë˜ëŠ” ê°œì„  ì‚¬í•­"
    response_time: "24ì‹œê°„ ì´ë‚´"
    escalation_time: "48ì‹œê°„"
    team: ["L1"]

response_procedures:
  step1_detect:
    - "ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì•Œë¦¼ í™•ì¸"
    - "ì„œë¹„ìŠ¤ ìƒíƒœ í˜ì´ì§€ ì—…ë°ì´íŠ¸"
    - "ì´ˆê¸° ì˜í–¥ ë²”ìœ„ í‰ê°€"
    
  step2_assess:
    - "ì¥ì•  ì›ì¸ ì´ˆê¸° ë¶„ì„"
    - "ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥ë„ í‰ê°€"
    - "ìš°ì„ ìˆœìœ„ ê²°ì •"
    
  step3_mitigate:
    - "ì¦‰ì‹œ ì™„í™” ì¡°ì¹˜ ì‹¤í–‰"
    - "íŠ¸ë˜í”½ ìš°íšŒ ë˜ëŠ” ì„œë¹„ìŠ¤ ê²©ë¦¬"
    - "ë°±ì—… ì‹œìŠ¤í…œ í™œì„±í™”"
    
  step4_resolve:
    - "ê·¼ë³¸ ì›ì¸ ë¶„ì„"
    - "ì˜êµ¬ ìˆ˜ì • ì‚¬í•­ ì ìš©"
    - "ì„œë¹„ìŠ¤ ì •ìƒí™” í™•ì¸"
    
  step5_communicate:
    - "ìƒíƒœ ì—…ë°ì´íŠ¸ ê³µì§€"
    - "ì´í•´ê´€ê³„ì ì»¤ë®¤ë‹ˆì¼€ì´ì…˜"
    - "ê³ ê° ë° ì‚¬ìš©ì ê³µì§€"
    
  step6_postmortem:
    - "í¬ìŠ¤íŠ¸ëª¨í…œ íšŒì˜ ì§„í–‰"
    - "ê°œì„  ì‚¬í•­ ë„ì¶œ"
    - "ì•¡ì…˜ í”Œëœ ìˆ˜ë¦½"
```

#### ìë™ ì¥ì•  ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# ìë™ ì¥ì•  ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸

ALERT_TYPE=${1:-"unknown"}
ALERT_SEVERITY=${2:-"warning"}

echo "ğŸš¨ ì¥ì•  ê°ì§€ - íƒ€ì…: $ALERT_TYPE, ì‹¬ê°ë„: $ALERT_SEVERITY"

case $ALERT_TYPE in
  "pod_crash_loop")
    echo "ğŸ”„ Pod CrashLoopBackOff ë³µêµ¬ ì¤‘..."
    # ìµœê·¼ ì¬ì‹œì‘ëœ Pod í™•ì¸
    POD_NAME=$(kubectl get pods -A --field-selector=status.phase=Failed -o name | head -1)
    if [ -n "$POD_NAME" ]; then
      kubectl delete $POD_NAME
      echo "âœ… ì‹¤íŒ¨í•œ Pod ì¬ì‹œì‘: $POD_NAME"
    fi
    ;;
    
  "high_memory_usage")
    echo "ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€ ëŒ€ì‘ ì¤‘..."
    # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë†’ì€ Pod ì‹ë³„
    kubectl top pods -A --sort-by=memory | head -10
    
    # HPA ìŠ¤ì¼€ì¼ ì—… ê°•ì œ ì‹¤í–‰
    kubectl patch hpa api-server-hpa -p '{"spec":{"minReplicas":5}}'
    echo "âœ… HPA ìµœì†Œ ë ˆí”Œë¦¬ì¹´ ì¦ê°€"
    ;;
    
  "database_connection_limit")
    echo "ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í•œê³„ ëŒ€ì‘ ì¤‘..."
    # ìœ íœ´ ì—°ê²° ì •ë¦¬
    kubectl exec -n hankook-smartsensor postgresql-cluster-0 -- \
      psql -U postgres -c "SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE state = 'idle' AND query_start < now() - interval '10 minutes';"
    echo "âœ… ìœ íœ´ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë¦¬ ì™„ë£Œ"
    ;;
    
  "disk_space_low")
    echo "ğŸ’¾ ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡± ëŒ€ì‘ ì¤‘..."
    # ë¡œê·¸ íŒŒì¼ ì •ë¦¬
    kubectl get pods -A -o name | xargs -I {} kubectl exec {} -- find /var/log -name "*.log" -mtime +7 -delete 2>/dev/null || true
    
    # ì„ì‹œ íŒŒì¼ ì •ë¦¬
    kubectl get pods -A -o name | xargs -I {} kubectl exec {} -- find /tmp -type f -mtime +1 -delete 2>/dev/null || true
    echo "âœ… ë””ìŠ¤í¬ ê³µê°„ ì •ë¦¬ ì™„ë£Œ"
    ;;
    
  "ssl_certificate_expiring")
    echo "ğŸ“œ SSL ì¸ì¦ì„œ ë§Œë£Œ ì„ë°• ëŒ€ì‘ ì¤‘..."
    # Cert-managerë¥¼ í†µí•œ ì¸ì¦ì„œ ê°±ì‹  ê°•ì œ ì‹¤í–‰
    kubectl annotate certificate --all cert-manager.io/issue-temporary-certificate=true
    echo "âœ… SSL ì¸ì¦ì„œ ê°±ì‹  ìš”ì²­ ì™„ë£Œ"
    ;;
    
  *)
    echo "âš ï¸ ì•Œ ìˆ˜ ì—†ëŠ” ì¥ì•  ìœ í˜•: $ALERT_TYPE"
    echo "ìˆ˜ë™ ëŒ€ì‘ì´ í•„ìš”í•©ë‹ˆë‹¤."
    ;;
esac

# ë³µêµ¬ í›„ ìƒíƒœ í™•ì¸
sleep 30
echo "ğŸ” ë³µêµ¬ í›„ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸:"
kubectl get pods -A | grep -v Running | grep -v Completed || echo "ëª¨ë“  Podê°€ ì •ìƒ ìƒíƒœì…ë‹ˆë‹¤"

echo "ğŸ ìë™ ë³µêµ¬ ì™„ë£Œ: $(date)"
```

### í¬ìŠ¤íŠ¸ëª¨í…œ í”„ë¡œì„¸ìŠ¤

#### í¬ìŠ¤íŠ¸ëª¨í…œ í…œí”Œë¦¿
```markdown
# ì¸ì‹œë˜íŠ¸ í¬ìŠ¤íŠ¸ëª¨í…œ

## ê¸°ë³¸ ì •ë³´
- **ì¸ì‹œë˜íŠ¸ ID**: INC-2024-001
- **ë°œìƒ ì¼ì‹œ**: 2024-01-26 14:30 KST
- **í•´ê²° ì¼ì‹œ**: 2024-01-26 16:45 KST
- **ì´ ì˜í–¥ ì‹œê°„**: 2ì‹œê°„ 15ë¶„
- **ì‹¬ê°ë„**: P2 (High)
- **ë‹´ë‹¹ì**: DevOps íŒ€

## ì¸ì‹œë˜íŠ¸ ìš”ì•½
API ì„œë²„ì˜ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¡œ ì¸í•œ ì„œë¹„ìŠ¤ ì‘ë‹µ ì§€ì—° ë° ì¼ë¶€ ìš”ì²­ ì‹¤íŒ¨

## íƒ€ì„ë¼ì¸
- **14:30** - Prometheus ì•Œë¦¼ìœ¼ë¡œ ë†’ì€ ì‘ë‹µ ì‹œê°„ ê°ì§€
- **14:35** - L1 íŒ€ ì´ˆê¸° ëŒ€ì‘ ì‹œì‘
- **14:45** - L2 íŒ€ ì—ìŠ¤ì»¬ë ˆì´ì…˜
- **15:00** - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì›ì¸ ì‹ë³„
- **15:30** - ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘ ê²°ì •
- **15:45** - ë¡¤ë§ ì—…ë°ì´íŠ¸ ì‹œì‘
- **16:15** - ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ êµì²´ ì™„ë£Œ
- **16:30** - ì„œë¹„ìŠ¤ ì •ìƒí™” í™•ì¸
- **16:45** - ì¸ì‹œë˜íŠ¸ ì¢…ë£Œ ì„ ì–¸

## ê·¼ë³¸ ì›ì¸
ë°°ì¹˜ ì²˜ë¦¬ ì‘ì—…ì—ì„œ ëŒ€ëŸ‰ì˜ ì„¼ì„œ ë°ì´í„° ì²˜ë¦¬ ì‹œ ë©”ëª¨ë¦¬ í•´ì œê°€ ì œëŒ€ë¡œ ì´ë£¨ì–´ì§€ì§€ ì•Šì•„ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ

## ì˜í–¥ ë²”ìœ„
- **ì‚¬ìš©ì ì˜í–¥**: ì•½ 500ëª…ì˜ í™œì„± ì‚¬ìš©ì
- **ì„œë¹„ìŠ¤ ì˜í–¥**: API ì‘ë‹µ ì‹œê°„ 500ms â†’ 3000ms ì¦ê°€
- **ë°ì´í„° ì˜í–¥**: ì—†ìŒ (ëª¨ë“  ë°ì´í„° ì •ìƒ ì²˜ë¦¬)
- **ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥**: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì§€ì—°

## ëŒ€ì‘ ì¡°ì¹˜
### ì¦‰ì‹œ ëŒ€ì‘
1. API ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ìˆ˜ ì¦ê°€ (3 â†’ 6)
2. ë¡œë“œ ë°¸ëŸ°ì„œ í—¬ìŠ¤ ì²´í¬ ê°„ê²© ë‹¨ì¶•
3. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë†’ì€ ì¸ìŠ¤í„´ìŠ¤ ìš°ì„  ì¬ì‹œì‘

### ê·¼ë³¸ì  í•´ê²°
1. ë°°ì¹˜ ì²˜ë¦¬ ë¡œì§ì—ì„œ ë©”ëª¨ë¦¬ í•´ì œ ì½”ë“œ ì¶”ê°€
2. ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ë§ ë„êµ¬ ì ìš©
3. ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ íŠœë‹

## í–¥í›„ ê°œì„  ì‚¬í•­
1. **ì˜ˆë°© ì¡°ì¹˜**
   - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì•Œë¦¼ ì„ê³„ê°’ ì¡°ì • (70% â†’ 60%)
   - ìë™ ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ë§ ë„êµ¬ ë„ì…
   - ë°°ì¹˜ ì‘ì—… ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ ê°•í™”

2. **ê°ì§€ ê°œì„ **
   - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ íŒ¨í„´ íƒì§€ ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
   - ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ì„¸ë¶„í™”ëœ ëª¨ë‹ˆí„°ë§

3. **ëŒ€ì‘ ê°œì„ **
   - ìë™ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‹œì‘ ì •ì±… ìˆ˜ë¦½
   - ì¥ì•  ëŒ€ì‘ í”Œë ˆì´ë¶ ì—…ë°ì´íŠ¸

## ì•¡ì…˜ ì•„ì´í…œ
| í•­ëª© | ë‹´ë‹¹ì | ì™„ë£Œ ëª©í‘œì¼ | ìƒíƒœ |
|------|--------|-------------|------|
| ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìˆ˜ì • ì½”ë“œ ë°°í¬ | ê°œë°œíŒ€ | 2024-01-28 | ì§„í–‰ì¤‘ |
| ëª¨ë‹ˆí„°ë§ ì„ê³„ê°’ ì¡°ì • | DevOpsíŒ€ | 2024-01-27 | ì™„ë£Œ |
| ìë™ ì¬ì‹œì‘ ì •ì±… ìˆ˜ë¦½ | SREíŒ€ | 2024-02-05 | ê³„íšì¤‘ |

## êµí›ˆ
1. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€ëŠ” ì ì§„ì ì´ë¯€ë¡œ ì¡°ê¸° ê°ì§€ê°€ ì¤‘ìš”
2. ë°°ì¹˜ ì‘ì—…ì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš© íŒ¨í„´ì„ ë³„ë„ë¡œ ëª¨ë‹ˆí„°ë§ í•„ìš”
3. ìë™ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ì˜ ì¤‘ìš”ì„± ì¬í™•ì¸
```

## ğŸ“ˆ ìš©ëŸ‰ ê³„íš

### ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ë¶„ì„

#### ìš©ëŸ‰ ê³„íš ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# ìš©ëŸ‰ ê³„íš ë° ì˜ˆì¸¡ ìŠ¤í¬ë¦½íŠ¸

echo "ğŸ“Š ìš©ëŸ‰ ê³„íš ë¶„ì„ ì‹œì‘: $(date)"

# 1. í˜„ì¬ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ìˆ˜ì§‘
echo "ğŸ’» í˜„ì¬ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰:"
kubectl top nodes
kubectl top pods -A --sort-by=memory | head -20

# 2. íˆìŠ¤í† ë¦¬ ë°ì´í„° ë¶„ì„ (Prometheus ì¿¼ë¦¬)
echo "ğŸ“ˆ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ íŠ¸ë Œë“œ (ì§€ë‚œ 30ì¼):"
PROM_URL="http://prometheus.monitoring.svc.cluster.local:9090"

# CPU ì‚¬ìš©ëŸ‰ íŠ¸ë Œë“œ
curl -s "${PROM_URL}/api/v1/query_range?query=100-(avg(rate(node_cpu_seconds_total{mode=\"idle\"}[5m]))*100)&start=$(date -d '30 days ago' +%s)&end=$(date +%s)&step=3600" | \
  jq -r '.data.result[0].values[] | "\(.[0]) \(.[1])"' > cpu_usage_30days.txt

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ íŠ¸ë Œë“œ  
curl -s "${PROM_URL}/api/v1/query_range?query=(1-(node_memory_MemAvailable_bytes/node_memory_MemTotal_bytes))*100&start=$(date -d '30 days ago' +%s)&end=$(date +%s)&step=3600" | \
  jq -r '.data.result[0].values[] | "\(.[0]) \(.[1])"' > memory_usage_30days.txt

# 3. ì„±ì¥ë¥  ê³„ì‚°
echo "ğŸ“ˆ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ì„±ì¥ë¥ :"
python3 << EOF
import numpy as np
from datetime import datetime, timedelta

# CPU ì‚¬ìš©ëŸ‰ ë¶„ì„
with open('cpu_usage_30days.txt', 'r') as f:
    cpu_data = [float(line.split()[1]) for line in f.readlines()]

if cpu_data:
    cpu_trend = np.polyfit(range(len(cpu_data)), cpu_data, 1)[0]
    print(f"CPU ì‚¬ìš©ëŸ‰ ì¼ì¼ ì¦ê°€ìœ¨: {cpu_trend:.3f}%")
    
    # 6ê°œì›” ì˜ˆì¸¡
    current_avg = np.mean(cpu_data[-7:])  # ìµœê·¼ 7ì¼ í‰ê· 
    predicted_6m = current_avg + (cpu_trend * 180)
    print(f"í˜„ì¬ í‰ê·  CPU ì‚¬ìš©ë¥ : {current_avg:.1f}%")
    print(f"6ê°œì›” í›„ ì˜ˆìƒ CPU ì‚¬ìš©ë¥ : {predicted_6m:.1f}%")

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë¶„ì„
with open('memory_usage_30days.txt', 'r') as f:
    memory_data = [float(line.split()[1]) for line in f.readlines()]

if memory_data:
    memory_trend = np.polyfit(range(len(memory_data)), memory_data, 1)[0]
    print(f"ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¼ì¼ ì¦ê°€ìœ¨: {memory_trend:.3f}%")
    
    current_avg = np.mean(memory_data[-7:])
    predicted_6m = current_avg + (memory_trend * 180)
    print(f"í˜„ì¬ í‰ê·  ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {current_avg:.1f}%")
    print(f"6ê°œì›” í›„ ì˜ˆìƒ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {predicted_6m:.1f}%")
EOF

# 4. ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ëŸ‰ ë¶„ì„
echo "ğŸ’¾ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ëŸ‰ ë¶„ì„:"
kubectl exec -n hankook-smartsensor postgresql-cluster-0 -- \
  psql -U postgres -d hankook_sensors -c "
    SELECT 
      schemaname,
      tablename,
      pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size,
      pg_total_relation_size(schemaname||'.'||tablename) as size_bytes
    FROM pg_tables 
    WHERE schemaname NOT IN ('information_schema', 'pg_catalog')
    ORDER BY size_bytes DESC;
  "

# 5. ì„¼ì„œ ë°ì´í„° ì¦ê°€ìœ¨ ë¶„ì„
echo "ğŸ“Š ì„¼ì„œ ë°ì´í„° ì¦ê°€ìœ¨:"
kubectl exec -n hankook-smartsensor postgresql-cluster-0 -- \
  psql -U postgres -d hankook_sensors -c "
    SELECT 
      DATE(timestamp) as date,
      COUNT(*) as daily_records,
      AVG(COUNT(*)) OVER (ORDER BY DATE(timestamp) ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as rolling_7day_avg
    FROM sensors.sensor_data 
    WHERE timestamp >= NOW() - INTERVAL '30 days'
    GROUP BY DATE(timestamp)
    ORDER BY date DESC
    LIMIT 10;
  "

# 6. ìš©ëŸ‰ ê³„íš ê¶Œê³ ì‚¬í•­ ìƒì„±
echo "ğŸ“‹ ìš©ëŸ‰ ê³„íš ê¶Œê³ ì‚¬í•­:"
python3 << EOF
import json

# ì„ê³„ê°’ ì„¤ì •
CPU_THRESHOLD = 70
MEMORY_THRESHOLD = 80
STORAGE_THRESHOLD = 80

recommendations = []

# CPU ê¶Œê³ ì‚¬í•­
if predicted_6m > CPU_THRESHOLD:
    recommendations.append({
        "resource": "CPU",
        "action": "ë…¸ë“œ ì¶”ê°€ ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ì—…ê·¸ë ˆì´ë“œ",
        "timeline": "3-4ê°œì›” ë‚´",
        "urgency": "high" if predicted_6m > 85 else "medium"
    })

# ë©”ëª¨ë¦¬ ê¶Œê³ ì‚¬í•­  
if predicted_6m > MEMORY_THRESHOLD:
    recommendations.append({
        "resource": "Memory", 
        "action": "ë©”ëª¨ë¦¬ ì¦ì„¤ ë˜ëŠ” ì›Œì»¤ ë…¸ë“œ ì¶”ê°€",
        "timeline": "2-3ê°œì›” ë‚´",
        "urgency": "high" if predicted_6m > 90 else "medium"
    })

# ê¶Œê³ ì‚¬í•­ ì¶œë ¥
for rec in recommendations:
    print(f"âš ï¸ {rec['resource']}: {rec['action']} ({rec['timeline']})")

if not recommendations:
    print("âœ… í˜„ì¬ ìš©ëŸ‰ìœ¼ë¡œ 6ê°œì›” ì•ˆì •ì  ìš´ì˜ ê°€ëŠ¥")
EOF

echo "âœ… ìš©ëŸ‰ ê³„íš ë¶„ì„ ì™„ë£Œ: $(date)"
```

### í™•ì¥ ê³„íš

#### í´ëŸ¬ìŠ¤í„° í™•ì¥ ì „ëµ
```yaml
# cluster-scaling-strategy.yaml
scaling_triggers:
  scale_out:  # ë…¸ë“œ ì¶”ê°€
    cpu_threshold: 70%
    memory_threshold: 80% 
    duration: 15ë¶„
    
  scale_up:   # ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ì—…ê·¸ë ˆì´ë“œ
    cpu_threshold: 85%
    memory_threshold: 90%
    duration: 30ë¶„

node_groups:
  general:
    instance_type: m5.xlarge
    min_size: 3
    max_size: 10
    target_capacity: 5
    
  memory_optimized:
    instance_type: r5.xlarge  
    min_size: 0
    max_size: 5
    target_capacity: 2
    
  compute_optimized:
    instance_type: c5.xlarge
    min_size: 0
    max_size: 3
    target_capacity: 1

storage_scaling:
  postgresql:
    current_size: 500GB
    growth_rate: 10GB/month
    next_resize: 1TB
    resize_trigger: 80%
    
  elasticsearch:
    current_size: 200GB
    growth_rate: 5GB/month
    retention_policy: 30days
    hot_tier: 50GB
    warm_tier: 150GB
```

---

**ğŸ¯ ì²´ê³„ì ì¸ ìš´ì˜ ê´€ë¦¬ë¥¼ í†µí•´ ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ ì‹œìŠ¤í…œì„ ìœ ì§€í•˜ì„¸ìš”!**

Â© 2024 HankookTire SmartSensor 2.0. All rights reserved.